@model TimeTravelAgency.Domain.ViewModels.TourViewModels.TourWithPicturesViewModel
@using System.Security.Claims;
@using TimeTravelAgency.Domain.Enum

@{
    ViewBag.Title = "Информация";
    Layout = "_Layout";
}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="~/css/carousel.css" />
</head>



<div class="container-fluid container-welcome container-height-page no-mp">
    @if (Model.pictures.ContainsKey(string.Format("{0}-welcome", Model.tour.Id)))
    {
        <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures[string.Format("{0}-welcome", Model.tour.Id)].Image))" class="img-fluid rounded-start img-width-full" />
    }
    else
    {
        <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures["not-found"].Image))" class="img-fluid rounded-start img-width-full" />
    }
    <div class="img-content">
        <p class="text-white text-welcome">@Model.tour.Title</p>
    </div>
</div>

<div class="container-fluid no-mp bg-white">
    <div class="row align-items-center py-5" style="height: 90vh;">

        <div class="row justify-content-evenly py-4 h-100">
            <div class="col-4 align-self-center">
                <div class="d-flex flex-column">
                    <div>
                        <h2 class="py-3">«@Model.tour.Title»</h2>
                        <p class="fs-5">@($"{Model.tour.DateStart.ToString("D")}") - @($"{Model.tour.DateEnd.ToString("D")}")</p>
                    </div>
                    <div class="d-flex flex-row">
                        <p class="me-4"><strong>Цена:</strong> @Model.tour.Price ₽</p>
                        <p><strong>Количество мест:</strong> @Model.tour.NumberOfPlaces</p>
                    </div>

                    <div>
                        <p class="mb-5">@Model.tour.FullInfo</p>
                    </div>

                    @if (User.Identity.IsAuthenticated)
                    {
                        <div class="col-6">
                            <a class="btn btn-dark" asp-controller="Order" asp-action="AddTourToCart" asp-route-tourId="@Model.tour.Id" asp-route-userId="@Convert.ToInt32(User.FindFirst(ClaimTypes.NameIdentifier).Value)">Добавить в корзину</a>
                        </div>
                    }
                </div>
            </div>

            <div class="col-4 h-100">
                <div class="container h-100 overflow-hidden" style="height: 50vh">
                    @if (Model.pictures.ContainsKey(string.Format("{0}-full-info", Model.tour.Id)))
                    {
                        <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures[string.Format("{0}-full-info", Model.tour.Id)].Image))" class="img-fluid rounded-start img-width-full" />
                    }
                    else
                    {
                        <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures["not-found"].Image))" class="img-fluid rounded-start img-width-full" />
                    }
                </div>
            </div>

        </div>

    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-10 mt-5">
            <div class="carousel-container position-relative row">
                <div id="myCarousel" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active" data-slide-number="0">
                            <div class="container-fluid carousel-img no-mp">
                                @if (Model.pictures.ContainsKey(string.Format("{0}-carousel-0", Model.tour.Id)))
                                {
                                    <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures[string.Format("{0}-carousel-0", Model.tour.Id)].Image))" class="d-block w-100" style="height:100%" alt="..." data-type="image" data-toggle="lightbox" data-gallery="example-gallery">
                                }
                                else
                                {
                                    <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures["not-found"].Image))" class="d-block w-100" alt="..." data-type="image" data-toggle="lightbox" data-gallery="example-gallery" />
                                }
                            </div>
                        </div>
                        @for (int i = 1; i < 6; i++)
                        {
                            <div class="carousel-item" data-slide-number="@i">
                                <div class="container-fluid carousel-img no-mp">
                                    @if (Model.pictures.ContainsKey(string.Format("{0}-carousel-{1}", Model.tour.Id, i)))
                                    {
                                        <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures[string.Format("{0}-carousel-{1}", Model.tour.Id, i)].Image))" class="d-block w-100" alt="..." data-type="image" data-toggle="lightbox" data-gallery="example-gallery">
                                    }
                                    else
                                    {
                                        <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures["not-found"].Image))" class="d-block w-100" alt="..." data-type="image" data-toggle="lightbox" data-gallery="example-gallery" />
                                    }
                                </div>
                            </div>
                        }

                        <div class="carousel-item" data-slide-number="6">
                            <img src="https://source.unsplash.com/uanoYn1AmPs/1600x900/" class="d-block w-100" alt="..." data-remote="https://source.unsplash.com/uanoYn1AmPs/" data-type="image" data-toggle="lightbox" data-gallery="example-gallery">
                        </div>
                        <div class="carousel-item" data-slide-number="7">
                            <img src="https://source.unsplash.com/_snqARKTgoc/1600x900/" class="d-block w-100" alt="..." data-remote="https://source.unsplash.com/_snqARKTgoc/" data-type="image" data-toggle="lightbox" data-gallery="example-gallery">
                        </div>
                        <div class="carousel-item" data-slide-number="8">
                            <img src="https://source.unsplash.com/M9F8VR0jEPM/1600x900/" class="d-block w-100" alt="..." data-remote="https://source.unsplash.com/M9F8VR0jEPM/" data-type="image" data-toggle="lightbox" data-gallery="example-gallery">
                        </div>
                        <div class="carousel-item" data-slide-number="9">
                            <img src="https://source.unsplash.com/Q1p7bh3SHj8/1600x900/" class="d-block w-100" alt="..." data-remote="https://source.unsplash.com/Q1p7bh3SHj8/" data-type="image" data-toggle="lightbox" data-gallery="example-gallery">
                        </div>
                    </div>
                </div>

                <!-- Carousel Navigation -->
                <div id="carousel-thumbs" class="carousel slide carousel-dark" data-bs-target="#carouselExampleDark" data-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <div class="row mx-0">
                                <div id="carousel-selector-0" class="thumb col-4 col-sm-2 px-1 py-2 selected" data-target="#myCarousel" data-slide-to="0">
                                    <div class="container-fluid carousel-img-nav no-mp">
                                        @if (Model.pictures.ContainsKey(string.Format("{0}-carousel-0", Model.tour.Id)))
                                        {
                                            <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures[string.Format("{0}-carousel-0", Model.tour.Id)].Image))" class="img-fluid" style="height:100%, width:100%" alt="...">
                                        }
                                        else
                                        {
                                            <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures["not-found"].Image))" class="img-fluid" alt="..." />
                                        }
                                    </div>
                                </div>
                                @for (int i = 1; i < 6; i++)
                                {
                                    <div id="@string.Format("carousel-selector-{0}", i)" class="thumb col-4 col-sm-2 px-1 py-2" data-target="#myCarousel" data-slide-to="@i">
                                        <div class="container-fluid carousel-img-nav no-mp">
                                            @if (Model.pictures.ContainsKey(string.Format("{0}-carousel-{1}", Model.tour.Id, i)))
                                            {
                                                <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures[string.Format("{0}-carousel-{1}", Model.tour.Id, i)].Image))" class="img-fluid" style="height:100%, width:100%" alt="...">
                                            }
                                            else
                                            {
                                                <img src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.pictures["not-found"].Image))" class="img-fluid" alt="..." />
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="row mx-0">
                                <div id="carousel-selector-6" class="thumb col-4 col-sm-2 px-1 py-2" data-target="#myCarousel" data-slide-to="6">
                                    <img src="https://source.unsplash.com/uanoYn1AmPs/600x400/" class="img-fluid" alt="...">
                                </div>
                                <div id="carousel-selector-7" class="thumb col-4 col-sm-2 px-1 py-2" data-target="#myCarousel" data-slide-to="7">
                                    <img src="https://source.unsplash.com/_snqARKTgoc/600x400/" class="img-fluid" alt="...">
                                </div>
                                <div id="carousel-selector-8" class="thumb col-4 col-sm-2 px-1 py-2" data-target="#myCarousel" data-slide-to="8">
                                    <img src="https://source.unsplash.com/M9F8VR0jEPM/600x400/" class="img-fluid" alt="...">
                                </div>
                                <div id="carousel-selector-9" class="thumb col-4 col-sm-2 px-1 py-2" data-target="#myCarousel" data-slide-to="9">
                                    <img src="https://source.unsplash.com/Q1p7bh3SHj8/600x400/" class="img-fluid" alt="...">
                                </div>
                                <div class="col-2 px-1 py-2"></div>
                                <div class="col-2 px-1 py-2"></div>
                            </div>
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carousel-thumbs" data-bs-target="#carouselExampleDark" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carousel-thumbs" data-bs-target="#carouselExampleDark" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>

            </div>
        </div>
    </div> <!-- /row -->
</div> <!-- /container -->
@section scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.js"></script>

    <script>
        $('#myCarousel').carousel({
            interval: false
        });
        $('#carousel-thumbs').carousel({
            interval: false
        });

        // handles the carousel thumbnails
        // https://stackoverflow.com/questions/25752187/bootstrap-carousel-with-thumbnails-multiple-carousel
        $('[id^=carousel-selector-]').click(function () {
            var id_selector = $(this).attr('id');
            var id = parseInt(id_selector.substr(id_selector.lastIndexOf('-') + 1));
            $('#myCarousel').carousel(id);
        });
        // Only display 3 items in nav on mobile.
        if ($(window).width() < 575) {
            $('#carousel-thumbs .row div:nth-child(4)').each(function () {
                var rowBoundary = $(this);
                $('<div class="row mx-0">').insertAfter(rowBoundary.parent()).append(rowBoundary.nextAll().addBack());
            });
            $('#carousel-thumbs .carousel-item .row:nth-child(even)').each(function () {
                var boundary = $(this);
                $('<div class="carousel-item">').insertAfter(boundary.parent()).append(boundary.nextAll().addBack());
            });
        }
        // Hide slide arrows if too few items.
        if ($('#carousel-thumbs .carousel-item').length < 2) {
            $('#carousel-thumbs [class^=carousel-control-]').remove();
            $('.machine-carousel-container #carousel-thumbs').css('padding', '0 5px');
        }
        // when the carousel slides, auto update
        $('#myCarousel').on('slide.bs.carousel', function (e) {
            var id = parseInt($(e.relatedTarget).attr('data-slide-number'));
            $('[id^=carousel-selector-]').removeClass('selected');
            $('[id=carousel-selector-' + id + ']').addClass('selected');
        });
        // when user swipes, go next or previous
        // $('#myCarousel').swipe({
        //     fallbackToMouseEvents: true,
        //     swipeLeft: function (e) {
        //         $('#myCarousel').carousel('next');
        //     },
        //     swipeRight: function (e) {
        //         $('#myCarousel').carousel('prev');
        //     },
        //     allowPageScroll: 'vertical',
        //     preventDefaultEvents: false,
        //     threshold: 75
        // });
        /*
        $(document).on('click', '[data-toggle="lightbox"]', function(event) {
          event.preventDefault();
          $(this).ekkoLightbox();
        });
        */

        $('#myCarousel .carousel-item img').on('click', function (e) {
            var src = $(e.target).attr('data-remote');
            if (src) $(this).ekkoLightbox();
        });
    </script>

}

